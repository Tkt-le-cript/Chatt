<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>ChattFun - Connexion locale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family:Arial,sans-serif; text-align:center; padding:40px; }
    input, button { padding:12px; width:90%; max-width:400px; font-size:16px; margin:10px auto; display:block; }
    button { background:#4CAF50; color:white; border:none; border-radius:8px; cursor:pointer; }
    #version-tag { position:fixed; top:5px; left:5px; background:rgba(0,0,0,0.6); color:white; padding:4px 8px; font-family:monospace; font-size:12px; border-radius:4px; z-index:9999; }
  </style>
</head>
<body>
  <div id="version-tag">Version 0.1.5</div>
  <h1>Connexion / Inscription</h1>
  <input type="text" id="pseudo" placeholder="Ton pseudo" />
  <input type="password" id="passwd" placeholder="Mot de passe" />
  <button id="btn">Valider</button>
  <p id="message"></p>

  <script>
    const btn = document.getElementById('btn');
    const msg = document.getElementById('message');

    function hash(str) {
      let h = 0;
      for (let i = 0; i < str.length; i++) h = (h << 5) - h + str.charCodeAt(i);
      return h.toString();
    }

    btn.addEventListener('click', () => {
      const pseudo = document.getElementById('pseudo').value.trim();
      const passwd = document.getElementById('passwd').value;

      if (!pseudo || passwd.length < 3) {
        msg.innerText = "Entre un pseudo et un mdp ≥ 3 caractères.";
        return;
      }

      const users = JSON.parse(localStorage.getItem('users') || '{}');
      const hashed = hash(passwd);

      if (users[pseudo]) {
        if (users[pseudo] === hashed) {
          msg.innerText = `Connexion réussie : bienvenue ${pseudo} 👍`;
        } else {
          msg.innerText = "Mot de passe incorrect.";
        }
      } else {
        users[pseudo] = hashed;
        localStorage.setItem('users', JSON.stringify(users));
        msg.innerText = `Inscription réussie : bienvenue ${pseudo} 🎉`;
      }
    });
  </script>
</body>
</html>
