<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>ChattFun - Connexion / Inscription</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background: #667eea; color: #fff; text-align:center; padding: 50px; }
    input, button { padding: 10px; margin: 5px; border-radius: 6px; border: none; font-size: 16px; }
    button { cursor: pointer; background: #4caf50; color: white; }
    button:hover { background: #45a049; }
    .error { color: #ff6666; }
    .success { color: #aaffaa; }
    form { margin-bottom: 20px; }
  </style>
</head>
<body>

<h1>ChattFun - Connexion / Inscription</h1>

<div id="msg" style="height:20px;"></div>

<div>
  <button id="showLogin">Se connecter</button>
  <button id="showSignup">S'inscrire</button>
</div>

<!-- Formulaire Connexion -->
<form id="loginForm" style="display:none;">
  <h2>Connexion</h2>
  <input id="loginUser" placeholder="Nom d'utilisateur" required /><br />
  <input id="loginPass" type="password" placeholder="Mot de passe" required /><br />
  <button type="submit">Connexion</button>
</form>

<!-- Formulaire Inscription -->
<form id="signupForm" style="display:none;">
  <h2>Inscription</h2>
  <input id="signupUser" placeholder="Nom d'utilisateur" required /><br />
  <input id="signupPass" type="password" placeholder="Mot de passe" required /><br />
  <input id="signupAge" type="number" placeholder="Âge (≥13)" min="13" required /><br />
  <input id="signupHeight" type="number" placeholder="Taille (cm)" min="50" max="300" /><br />
  <input id="signupHair" placeholder="Couleur des cheveux" /><br />
  <textarea id="signupBio" placeholder="À propos de toi..."></textarea><br />
  <button type="submit">S'inscrire</button>
</form>

<script>
  const msgEl = document.getElementById('msg');
  const loginForm = document.getElementById('loginForm');
  const signupForm = document.getElementById('signupForm');
  const showLoginBtn = document.getElementById('showLogin');
  const showSignupBtn = document.getElementById('showSignup');

  // Affiche login ou signup
  showLoginBtn.onclick = () => {
    signupForm.style.display = 'none';
    loginForm.style.display = 'block';
    msgEl.textContent = '';
  };
  showSignupBtn.onclick = () => {
    loginForm.style.display = 'none';
    signupForm.style.display = 'block';
    msgEl.textContent = '';
  };

  // Par défaut affichage connexion
  showLoginBtn.click();

  // Utilisateurs stockés dans localStorage sous 'users' (objet { pseudo: {...} })
  function getUsers() {
    return JSON.parse(localStorage.getItem('users') || '{}');
  }
  function setUsers(users) {
    localStorage.setItem('users', JSON.stringify(users));
  }

  // Connexion
  loginForm.onsubmit = e => {
    e.preventDefault();
    const user = document.getElementById('loginUser').value.trim();
    const pass = document.getElementById('loginPass').value;

    const users = getUsers();

    if (!users[user]) {
      msgEl.textContent = 'Utilisateur introuvable.';
      msgEl.className = 'error';
      return;
    }
    if (users[user].password !== pass) {
      msgEl.textContent = 'Mot de passe incorrect.';
      msgEl.className = 'error';
      return;
    }
    // Connexion OK
    localStorage.setItem('sessionUser', user);
    msgEl.textContent = 'Connexion réussie ! Redirection...';
    msgEl.className = 'success';
    setTimeout(() => window.location.href = 'app.html', 1000);
  };

  // Inscription
  signupForm.onsubmit = e => {
    e.preventDefault();
    const user = document.getElementById('signupUser').value.trim();
    const pass = document.getElementById('signupPass').value;
    const age = parseInt(document.getElementById('signupAge').value);
    const height = parseInt(document.getElementById('signupHeight').value) || '';
    const hair = document.getElementById('signupHair').value.trim();
    const bio = document.getElementById('signupBio').value.trim();

    if (user.length < 3) {
      msgEl.textContent = 'Nom d’utilisateur trop court.';
      msgEl.className = 'error';
      return;
    }
    if (pass.length < 4) {
      msgEl.textContent = 'Mot de passe trop court.';
      msgEl.className = 'error';
      return;
    }
    if (isNaN(age) || age < 13) {
      msgEl.textContent = 'Tu dois avoir au moins 13 ans.';
      msgEl.className = 'error';
      return;
    }

    const users = getUsers();
    if (users[user]) {
      msgEl.textContent = 'Ce nom d’utilisateur est déjà pris.';
      msgEl.className = 'error';
      return;
    }

    users[user] = {
      password: pass,
      age, height, hair, bio
    };

    setUsers(users);
    msgEl.textContent = 'Inscription réussie, connecte-toi !';
    msgEl.className = 'success';

    // Reset formulaire inscription
    signupForm.reset();

    // Afficher connexion
    showLoginBtn.click();
  };
</script>
</body>
</html>
